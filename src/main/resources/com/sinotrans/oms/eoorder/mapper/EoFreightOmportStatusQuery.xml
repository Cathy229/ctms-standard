<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC   
    "-//mybatis.org//DTD Mapper 3.0//EN"  
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.sinotrans.oms.eoorder.mapper"> 
    <select id="EoFreightOmportStatusQuery" parameterType="map" resultType="hashmap">  
		<include refid="util.PRE_SQL"></include>

/**如果是0 , 就是已下达 , 对应前台页面状态为false ,  如果是1 , 就是未下达 , 对应前台页面可用状态为true*/
SELECT EOEA.EOEA_ID,
       EOOR.EOOR_ID,       
       EOOR.REC_VER EOOR_REC_VER,--订单表版本号
       EOOR.EOOR_ORDER_FUDEJI,
      EOOR.EOOR_CONTRACT_NO,
      EOOR.EOOR_LEVEL,
      EOOR.EOOR_EBPJ_ID,
      EOOR.EOOR_ORDER_BARCODE,
      EOOR.EOOR_CONSIGNOR_EBCU_ID,
      EOOR.EOOR_CONSIGNOR_EBCU_CODE,
      EOOR.EOOR_CONSIGNOR_EBCU_NAME,
      EOOR.EOOR_CUSTOM_EBCU_ID,
      EOOR.EOOR_CUSTOM_EBCU_CODE,
      EOOR.EOOR_CUSTOM_EBCU_NAME,
      EOOR.EOOR_SUPPLIER_EBCU_ID,
      EOOR.EOOR_SUPPLIER_EBCU_CODE,
      EOOR.EOOR_SUPPLIER_EBCU_NAME,
      EOOR.EOOR_EBBU_ID,
      EOOR.EOOR_EBBU_BU_NAME,
      EOOR.EOOR_EBPE_ID,
      EOOR.EOOR_EBCC_NAME,
      EOOR.EOOR_ORDER_DATE,
      EOOR.EOOR_START_EBRG_ID,
      EOOR.EOOR_START_EBRG_NAME_CN,
      EOOR.EOOR_END_EBRG_ID,
      EOOR.EOOR_END_EBRG_NAME_CN,
      EOOR.EOOR_DOUBLE_ORDER,
      EOOR.EOOR_ESDE_ID,
      EOOR.EOOR_ESDE_NAME,
      EOOR.EOOR_SALE_ESST_ID,
      EOOR.EOOR_SALE_ESST_NAME,
      EOOR.EOOR_OPERATE_ESST_ID,
      EOOR.EOOR_OPERATE_ESST_NAME,
      EOOR.EOOR_SPECIAL_ORDER,
      EOOR.EOOR_TRAN_TYPE,
      EOOR.EOOR_OUT_DATE,
      EOOR.EOOR_LO_EBPP_ID,
      EOOR.EOOR_STATUS,
      EOOR.EOOR_WEIGHT,
      EOOR.EOOR_VOLUME,
      EOOR.EOOR_QUANTITY,
      EOOR.EOOR_QUANTITY_UNIT,
      EOOR.EOOR_NET_WEIGHT,
      EOOR.EOOR_REQ_DELIVERY_DATE,
      EOOR.EOOR_REQ_ARRIVAL_DATE,
      EOOR.EOOR_DELIVERY_PERIOD,
      EOOR.EOOR_ARRIVAL_PERIOD,
      EOOR.EOOR_SHIPPER_EBSP_ID,
      EOOR.EOOR_SHIPPER_EBSP_NAME_CN,
      EOOR.EOOR_SHIPPER_EBSA_POST,
      EOOR.EOOR_SHIPPER_EBSA_CONTACT,
      EOOR.EOOR_SHIPPER_EBSA_TEL,
      EOOR.EOOR_SHIPPER_EBSA_ID,
      EOOR.EOOR_SHIPPER_EBSA_ADDRESS,
      EOOR.EOOR_SHIPPER_EBRG_ID,
      EOOR.EOOR_SHIPPER_EBRG_NAME_CN,
      EOOR.EOOR_SHIPPER_EBPL_ID,
      EOOR.EOOR_SHIPPER_EBPL_NAME_CN,
      EOOR.EOOR_CONSIGNEE_EBSP_ID,
      EOOR.EOOR_CONSIGNEE_EBSP_NAME_CN,
      EOOR.EOOR_CONSIGNEE_EBSA_POST,
      EOOR.EOOR_CONSIGNEE_EBSA_CONTACT,
      EOOR.EOOR_CONSIGNEE_EBSA_TEL,
      EOOR.EOOR_CONSIGNEE_EBSA_ID,
      EOOR.EOOR_CONSIGNEE_EBSA_ADDRESS,
      EOOR.EOOR_CONSIGNEE_EBRG_ID,
      EOOR.EOOR_CONSIGNEE_EBRG_NAME_CN,
      EOOR.EOOR_CONSIGNEE_EBPL_ID,
      EOOR.EOOR_CONSIGNEE_EBPL_NAME_CN,
      EOOR.EOOR_TRANS_REQ,
      EOOR.EOOR_CONSIGNEE_REQ,
      EOOR.EOOR_DOC_REQ,
      EOOR.EOOR_REMARK,
      EOOR.EOOR_VOID_DESC,
      EOOR.EOOR_VOIDER,
      EOOR.EOOR_VOIDER_TIME,
      EOOR.EOOR_SCHEDULE_ID,
      EOOR.EOOR_SCHEDULE_NAME,
      EOOR.EOOR_RALATION_ID,
      EOOR.EOOR_RALATION_SO_NO,
      EOOR.EOOR_THEIR_PLATE,
      EOOR.EOOR_TOTAL_INCOME,
      EOOR.EOOR_DATA_SOURCE,
      EOOR.EOOR_MESSAGE_NAME,
      EOOR.EOOR_ORI_SINGLE_NO,
      EOOR.EOOR_CREATOR_NAME,
      EOOR.EOOR_CREATOR_EMAIL,
      EOOR.EOOR_CREATOR_TEL,
      EOOR.EOOR_TYPE,
      EOOR.EOOR_PREV_STATUS,
      EOOR.EOOR_PREV_PLAN_STATUS,
      EOOR.EOOR_CONSIGNEE_EBRG_NO,
      EOOR.EOOR_SHIPPER_EBRG_NO,
      EOOR.EOOR_SHIPPER_EBSA_FAX,
      EOOR.EOOR_SHIPPER_EBSA_EMAIL,
      EOOR.EOOR_CONSIGNEE_EBSA_FAX,
      EOOR.EOOR_CONSIGNEE_EBSA_EMAIL,
      EOOR.EOOR_F_CODE,
      EOOR.EOOR_BMS_EBBT_CODE,
      EOOR.EOOR_BMS_EBOT_CODE,
      EOOR.EOOR_BMS_ESDE_DEPARTMENT_CODE,
      EOOR.EOOR_BMS_EBSM_CODE,
      EOOR.EOOR_BMS_BUSINESS_CLASS,
      EOOR.EOOR_BMS_A_EBCU_CUSTOMER_NO,
      EOOR.EOOR_BMS_S_EBCU_CUSTOMER_NO,
      EOOR.EOOR_BMS_CARGO_TYPE,
      EOOR.EOOR_COMMERCE_TYPE,
      EOOR.EOOR_BMS_MONITOR_TYPE,
      EOOR.EOOR_BMS_COUNT_TYPE,
      EOOR.EOOR_EBBU_CODE,
      EOOR.EOOR_AMT_RECEIVABLE,
      EOOR.EOOR_AMT_PAYABLE,
      EOOR.EOOR_CHARGEOFF,
      EOOR.EOOR_PAYMENT_MODE,
      EOOR.EOOR_RECEIPT_RETURNTYPE,
      EOOR.EOOR_CONTAINER_COUNT,
      EOOR.EOOR_CARGO_SOURCE,
      (SELECT EORA.EORA_ID FROM EO_REQUEST_ABROAD EORA 
      		WHERE 1=1 
      			<if test="sqlCond.eoorId !='' and sqlCond.eoorId !=null">
			   	   AND  EORA_EOOR_ID=#{sqlCond.eoorId}
			   </if>
      			AND ROWNUM = 1) EORA_ID,
       (SELECT COUNT(*) FROM EO_ORDER_MATERIEL EOOM
       		WHERE 1=1
       			<if test="sqlCond.eoorId !='' and sqlCond.eoorId !=null">
			   	   AND  EOOM.EOOM_EOOR_ID=#{sqlCond.eoorId}
			   </if>
       			) EOOM_COUNT,
       (SELECT (CASE WHEN INSTR(WMSYS.WM_CONCAT(EOET.EOET_TASK_STATUS),'3')>0 THEN '0' ELSE '1' END) FROM EO_REQUEST_TRAILER EOET 
			WHERE 	1=1
					<if test="sqlCond.eoorId !='' and sqlCond.eoorId !=null">
				   	   AND  EOET.EOET_EOOR_ID=#{sqlCond.eoorId}
				   </if>
					) EOETSTATUS,
	   (SELECT (CASE WHEN INSTR(WMSYS.WM_CONCAT(EODD.EODD_TASK_STATUS),'3')>0 THEN '0' ELSE '1' END) FROM EO_REQUEST_DECLARATION_DEPUTE EODD
			WHERE 1=1
					<if test="sqlCond.eoorId !='' and sqlCond.eoorId !=null">
				   	   AND  EODD.EODD_EOOR_ID=#{sqlCond.eoorId}
				   </if>
					) EODDSTATUS,
	   (SELECT (CASE WHEN INSTR(WMSYS.WM_CONCAT(EOFO.EOFO_TASK_STATUS),'3')>0 THEN '0' ELSE '1' END) FROM EO_FREIGHT_OMPORT EOFO
			WHERE 1=1
				<if test="sqlCond.eoorId !='' and sqlCond.eoorId !=null">
			   	   AND  EOFO.EOFO_EOOR_ID=#{sqlCond.eoorId}
			   </if>
				AND EOFO.EOFO_IS_CHECK = 1) ISCHECK /*是否查验*/
			  FROM EO_ORDER EOOR
			  LEFT JOIN EO_ORDER_EXPAND_AGENCY EOEA ON EOOR.EOOR_ID = EOEA.EOEA_EOOR_ID
			 WHERE 1=1
			 	<if test="sqlCond.eoorId !='' and sqlCond.eoorId !=null">
			   	   AND  EOOR.EOOR_ID=#{sqlCond.eoorId}
			   </if>
			 	AND ROWNUM = 1
		<include refid="util.POST_SQL"></include>
	</select>
</mapper>
